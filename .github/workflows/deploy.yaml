name: Deploy to VPS

on:
  push:
    branches:
      - main

jobs:

  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Deploy to VPS
      uses: appleboy/ssh-action@v0.1.6
      with:
        host: ${{ secrets.VPS_HOST }}
        username: ${{ secrets.VPS_USER }}
        key: ${{ secrets.VPS_SSH_KEY }}
        port: ${{ secrets.VPS_PORT }}
        script: |

          cd easy-inventory
          git pull origin main
          
          echo "TYPEORM_HOST=${{ secrets.TYPEORM_HOST }}" > .env
          echo "TYPEORM_PORT=${{ secrets.TYPEORM_PORT }}" >> .env
          echo "TYPEORM_USERNAME=${{ secrets.TYPEORM_USERNAME }}" >> .env
          echo "TYPEORM_PASSWORD=${{ secrets.TYPEORM_PASSWORD }}" >> .env
          echo "TYPEORM_DATABASE=${{ secrets.TYPEORM_DATABASE }}" >> .env
          echo "JWT_SECRET_KEY=${{ secrets.JWT_SECRET_KEY }}" >> .env
          echo "NODE_ENV=${{ secrets.NODE_ENV }}" >> .env
          docker compose up -d --build